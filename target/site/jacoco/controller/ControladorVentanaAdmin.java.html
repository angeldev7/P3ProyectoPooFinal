<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="es"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ControladorVentanaAdmin.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">P3ProyectoPooFinal</a> &gt; <a href="index.source.html" class="el_package">controller</a> &gt; <span class="el_source">ControladorVentanaAdmin.java</span></div><h1>ControladorVentanaAdmin.java</h1><pre class="source lang-java linenums">package controller;

import model.*;
import view.VentanaAdmin;
import command.*;
import command.CheckinRapidoAdminCommand;
import command.CrearReservaCommand;
import command.FinalizarReservaCommand;
import singleton.GestorDisponibilidad;
import javax.swing.*;
import javax.swing.table.DefaultTableModel;
import java.util.List;
import java.math.BigDecimal;
import java.time.LocalDate;
import java.time.format.DateTimeFormatter;
import java.util.stream.Collectors;
import java.awt.GridBagLayout;
import java.awt.GridBagConstraints;

/**
 * Controlador para la ventana de administración moderna del hotel.
 * Implementa MVC con inyección de dependencias siguiendo principios SOLID.
 * 
 * Aplica principios SOLID:
 * - SRP: Se encarga únicamente de coordinar la vista admin con el modelo
 * - DIP: Depende de abstracciones (interfaces) no de implementaciones concretas
 * - OCP: Extensible mediante nuevos comandos sin modificar el controlador
 * 
 * @author asdw
 * @version 1.0
 */
public class ControladorVentanaAdmin {
    
    private final VentanaAdmin vista;
    private final IModeloService modeloService;
    private final ICommandInvoker commandInvoker;
    private final GestorDisponibilidad gestorDisponibilidad;
    private final ControladorHabitaciones controladorHabitaciones;
    
    // Paneles de la interfaz
    private final view.panels.PanelClientes panelClientes;
    private final view.panels.PanelHabitaciones panelHabitaciones;
    private final view.panels.PanelReservas panelReservas;
    private final JPanel panelDashboard; // El dashboard original
    private view.panels.PanelReportes panelReportes; // carga diferida
    
<span class="nc" id="L47">    private static final java.util.logging.Logger logger = </span>
<span class="nc" id="L48">        java.util.logging.Logger.getLogger(ControladorVentanaAdmin.class.getName());</span>

    /**
     * Constructor con inyección de dependencias.
     * Aplica DIP al recibir abstracciones como parámetros.
     * 
     * @param vista Interfaz gráfica de administración
     * @param modeloService Servicio del modelo (abstracción)
     * @param commandInvoker Gestor de comandos para Undo/Redo
     * @param gestorDisponibilidad Singleton para gestión de disponibilidad
     */
    public ControladorVentanaAdmin(VentanaAdmin vista, IModeloService modeloService, 
                                  ICommandInvoker commandInvoker, 
<span class="nc" id="L61">                                  GestorDisponibilidad gestorDisponibilidad) {</span>
<span class="nc" id="L62">        this.vista = vista;</span>
<span class="nc" id="L63">        this.modeloService = modeloService;</span>
<span class="nc" id="L64">        this.commandInvoker = commandInvoker;</span>
<span class="nc" id="L65">        this.gestorDisponibilidad = gestorDisponibilidad;</span>
        
        // Crear controlador de habitaciones con inyección de dependencias
<span class="nc" id="L68">        this.controladorHabitaciones = new ControladorHabitaciones(modeloService, gestorDisponibilidad);</span>
        
        // Inicializar paneles que gestionará este controlador
<span class="nc" id="L71">        this.panelDashboard = vista.getDashboardPanel(); // Guardamos la referencia al panel original</span>
<span class="nc" id="L72">    this.panelClientes = new view.panels.PanelClientes();</span>
<span class="nc" id="L73">    this.panelHabitaciones = new view.panels.PanelHabitaciones();</span>
<span class="nc" id="L74">    this.panelReservas = new view.panels.PanelReservas();</span>
        
        // Inicializar sistema
<span class="nc" id="L77">        inicializarSistema();</span>
<span class="nc" id="L78">        inicializarEventos();</span>
<span class="nc" id="L79">    inicializarEventosClientes();</span>
<span class="nc" id="L80">    inicializarEventosHabitaciones();</span>
<span class="nc" id="L81">    inicializarEventosReservas();</span>
<span class="nc" id="L82">        actualizarDashboard();</span>
<span class="nc" id="L83">    }</span>

    // ===== Reportes =====
    private void inicializarPanelReportes() {
<span class="nc" id="L87">        panelReportes = new view.panels.PanelReportes();</span>
<span class="nc" id="L88">    }</span>

    private void cargarDatosReportes() {
        try {
<span class="nc" id="L92">            List&lt;Reserva&gt; reservas = modeloService.obtenerTodasReservas();</span>
<span class="nc" id="L93">            double ingresosHoy = calcularIngresosHoy(reservas).doubleValue();</span>
<span class="nc bnc" id="L94" title="All 2 branches missed.">            long activas = reservas.stream().filter(r -&gt; r.getFechaSalida()==null).count();</span>
<span class="nc" id="L95">            panelReportes.setResumen(&quot;Ingresos hoy: $&quot;+String.format(&quot;%.2f&quot;, ingresosHoy)+&quot; | Reservas activas: &quot;+activas);</span>
<span class="nc" id="L96">        } catch (Exception e) {</span>
<span class="nc" id="L97">            panelReportes.setResumen(&quot;Error cargando reportes&quot;);</span>
<span class="nc" id="L98">        }</span>
<span class="nc" id="L99">    }</span>

    /**
     * Inicializa el sistema cargando datos básicos.
     */
    private void inicializarSistema() {
<span class="nc" id="L105">        controladorHabitaciones.inicializarHabitaciones();</span>
<span class="nc" id="L106">        actualizarGestorDisponibilidad();</span>
<span class="nc" id="L107">    }</span>

    /**
     * Actualiza el gestor de disponibilidad con el estado actual de las habitaciones.
     */
    private void actualizarGestorDisponibilidad() {
<span class="nc" id="L113">        List&lt;Habitacion&gt; habitaciones = modeloService.obtenerTodasHabitaciones();</span>
<span class="nc" id="L114">        gestorDisponibilidad.inicializar(habitaciones);</span>
<span class="nc" id="L115">    }</span>

    /**
     * Inicializa los eventos de la interfaz gráfica.
     */
    private void inicializarEventos() {
        // Los eventos del menu se configurarán dinámicamente
        // cuando se implementen las funcionalidades específicas
<span class="nc" id="L123">        configurarEventosMenu();</span>
        
        // Timer para actualizar dashboard cada 30 segundos
<span class="nc" id="L126">        Timer dashboardTimer = new Timer(30000, e -&gt; actualizarDashboard());</span>
<span class="nc" id="L127">        dashboardTimer.start();</span>
<span class="nc" id="L128">    }</span>
    
    /**
     * Configura los eventos del menú de navegación.
     */
    private void configurarEventosMenu() {
        // Este método se puede expandir para agregar funcionalidad específica
        // a cada botón del menú lateral
<span class="nc" id="L136">        logger.info(&quot;Eventos del menú configurados&quot;);</span>
<span class="nc" id="L137">    }</span>

    /**
     * Actualiza toda la información del dashboard.
     */
    public void actualizarDashboard() {
<span class="nc" id="L143">        SwingUtilities.invokeLater(() -&gt; {</span>
<span class="nc" id="L144">            actualizarTarjetasInformativas();</span>
<span class="nc" id="L145">            actualizarTablaReservas();</span>
<span class="nc" id="L146">        });</span>
<span class="nc" id="L147">    }</span>

    /**
     * Actualiza las tarjetas informativas del dashboard.
     */
    private void actualizarTarjetasInformativas() {
        try {
<span class="nc" id="L154">            List&lt;Habitacion&gt; todasHabitaciones = modeloService.obtenerTodasHabitaciones();</span>
<span class="nc" id="L155">            List&lt;Reserva&gt; todasReservas = modeloService.obtenerTodasReservas();</span>
            
            // Calcular estadísticas
<span class="nc" id="L158">            long habitacionesDisponibles = todasHabitaciones.stream()</span>
<span class="nc bnc" id="L159" title="All 2 branches missed.">                .filter(h -&gt; !h.isOcupada())</span>
<span class="nc" id="L160">                .count();</span>
                
<span class="nc" id="L162">            long habitacionesOcupadas = todasHabitaciones.stream()</span>
<span class="nc" id="L163">                .filter(Habitacion::isOcupada)</span>
<span class="nc" id="L164">                .count();</span>
                
<span class="nc" id="L166">            long checkinHoy = contarCheckinsHoy(todasReservas);</span>
<span class="nc" id="L167">            BigDecimal ingresosHoy = calcularIngresosHoy(todasReservas);</span>
            
            // Actualizar las tarjetas
<span class="nc" id="L170">            vista.actualizarTarjeta(&quot;Habitaciones Disponibles&quot;, String.valueOf(habitacionesDisponibles));</span>
<span class="nc" id="L171">            vista.actualizarTarjeta(&quot;Habitaciones Ocupadas&quot;, String.valueOf(habitacionesOcupadas));</span>
<span class="nc" id="L172">            vista.actualizarTarjeta(&quot;Check-ins Hoy&quot;, String.valueOf(checkinHoy));</span>
<span class="nc" id="L173">            vista.actualizarTarjeta(&quot;Ingresos del Día&quot;, String.format(&quot;$%.2f&quot;, ingresosHoy.doubleValue()));</span>
                
<span class="nc" id="L175">        } catch (Exception e) {</span>
<span class="nc" id="L176">            logger.severe(&quot;Error actualizando tarjetas informativas: &quot; + e.getMessage());</span>
<span class="nc" id="L177">            mostrarError(&quot;Error actualizando información del dashboard&quot;);</span>
<span class="nc" id="L178">        }</span>
<span class="nc" id="L179">    }</span>
    
    /**
     * Cuenta los check-ins realizados hoy.
     */
    private long contarCheckinsHoy(List&lt;Reserva&gt; reservas) {
<span class="nc" id="L185">        LocalDate hoy = LocalDate.now();</span>
<span class="nc" id="L186">        return reservas.stream()</span>
<span class="nc" id="L187">            .filter(r -&gt; r.getFechaIngreso().toInstant().atZone(java.time.ZoneId.systemDefault()).toLocalDate().equals(hoy))</span>
<span class="nc" id="L188">            .count();</span>
    }
    
    /**
     * Calcula los ingresos del día actual.
     */
    private BigDecimal calcularIngresosHoy(List&lt;Reserva&gt; reservas) {
<span class="nc" id="L195">        LocalDate hoy = LocalDate.now();</span>
<span class="nc" id="L196">        return reservas.stream()</span>
<span class="nc" id="L197">            .filter(r -&gt; r.getFechaIngreso().toInstant().atZone(java.time.ZoneId.systemDefault()).toLocalDate().equals(hoy))</span>
<span class="nc" id="L198">            .map(r -&gt; BigDecimal.valueOf(r.getTotal()))</span>
<span class="nc" id="L199">            .reduce(BigDecimal.ZERO, BigDecimal::add);</span>
    }

    /**
     * Actualiza la tabla de reservas recientes.
     */
    private void actualizarTablaReservas() {
        try {
<span class="nc" id="L207">            List&lt;Reserva&gt; reservasRecientes = modeloService.obtenerReservasRecientes(10);</span>
<span class="nc" id="L208">            List&lt;Habitacion&gt; todasHabitaciones = modeloService.obtenerTodasHabitaciones();</span>
<span class="nc" id="L209">            List&lt;Cliente&gt; todosClientes = modeloService.obtenerTodosClientes();</span>

            // Para optimizar, creamos mapas de búsqueda rápida
<span class="nc" id="L212">            java.util.Map&lt;String, Habitacion&gt; mapaHabitaciones = todasHabitaciones.stream()</span>
<span class="nc" id="L213">                .collect(Collectors.toMap(Habitacion::getId, h -&gt; h));</span>
<span class="nc" id="L214">            java.util.Map&lt;String, Cliente&gt; mapaClientes = todosClientes.stream()</span>
<span class="nc" id="L215">                .collect(Collectors.toMap(Cliente::getId, c -&gt; c));</span>

            // Construir solo filas válidas (sin datos huérfanos)
<span class="nc" id="L218">            java.util.List&lt;String[]&gt; filas = new java.util.ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L219" title="All 2 branches missed.">            for (Reserva reserva : reservasRecientes) {</span>
<span class="nc" id="L220">                Cliente cliente = mapaClientes.get(reserva.getIdCliente());</span>
<span class="nc" id="L221">                Habitacion habitacionAsociada = mapaHabitaciones.get(reserva.getIdHabitacion());</span>
<span class="nc bnc" id="L222" title="All 4 branches missed.">                if (cliente == null || habitacionAsociada == null) {</span>
                    // Saltar reservas inconsistente para no mostrar 'N/A'
<span class="nc" id="L224">                    continue;</span>
                }
<span class="nc" id="L226">                String numeroHabitacion = habitacionAsociada.getNumero();</span>
                String estadoReserva;
<span class="nc bnc" id="L228" title="All 2 branches missed.">                if (reserva.getFechaSalida() != null) {</span>
<span class="nc" id="L229">                    estadoReserva = &quot;Finalizada&quot;;</span>
<span class="nc bnc" id="L230" title="All 2 branches missed.">                } else if (habitacionAsociada.isOcupada()) {</span>
<span class="nc" id="L231">                    estadoReserva = &quot;Check-in&quot;;</span>
                } else {
<span class="nc" id="L233">                    estadoReserva = &quot;Reservada&quot;;</span>
                }
<span class="nc bnc" id="L235" title="All 2 branches missed.">                String fechaIngreso = reserva.getFechaIngreso() != null ?</span>
<span class="nc" id="L236">                    reserva.getFechaIngreso().toInstant().atZone(java.time.ZoneId.systemDefault()).toLocalDate()</span>
<span class="nc" id="L237">                        .format(DateTimeFormatter.ofPattern(&quot;dd/MM/yyyy&quot;)) : &quot;&quot;;</span>
<span class="nc bnc" id="L238" title="All 2 branches missed.">                String fechaSalida = reserva.getFechaSalida() != null ?</span>
<span class="nc" id="L239">                    reserva.getFechaSalida().toInstant().atZone(java.time.ZoneId.systemDefault()).toLocalDate()</span>
<span class="nc" id="L240">                        .format(DateTimeFormatter.ofPattern(&quot;dd/MM/yyyy&quot;)) : &quot;Activa&quot;;</span>
<span class="nc" id="L241">                filas.add(new String[]{</span>
<span class="nc" id="L242">                    cliente.getNombre()+&quot; &quot;+cliente.getApellido(),</span>
                    numeroHabitacion,
                    fechaIngreso,
                    fechaSalida,
                    estadoReserva
                });
<span class="nc" id="L248">            }</span>
<span class="nc" id="L249">            vista.actualizarTablaReservas(filas.toArray(new String[0][0]));</span>
            
<span class="nc" id="L251">        } catch (Exception e) {</span>
<span class="nc" id="L252">            logger.severe(&quot;Error actualizando tabla de reservas: &quot; + e.getMessage());</span>
<span class="nc" id="L253">            mostrarError(&quot;Error actualizando tabla de reservas&quot;);</span>
<span class="nc" id="L254">        }</span>
<span class="nc" id="L255">    }</span>

    /**
     * Navega a una sección específica del dashboard.
     * 
     * @param seccion Sección a mostrar (Dashboard, Habitaciones, Reservas, etc.)
     */
    public void navegarA(String seccion) {
<span class="nc" id="L263">        SwingUtilities.invokeLater(() -&gt; {</span>
<span class="nc bnc" id="L264" title="All 26 branches missed.">            switch (seccion) {</span>
                case &quot;Dashboard&quot;:
<span class="nc" id="L266">                    actualizarDashboard();</span>
<span class="nc" id="L267">                    break;</span>
                case &quot;Habitaciones&quot;:
<span class="nc" id="L269">                    mostrarVistaHabitaciones();</span>
<span class="nc" id="L270">                    break;</span>
                case &quot;Reservas&quot;:
<span class="nc" id="L272">                    mostrarVistaReservas();</span>
<span class="nc" id="L273">                    break;</span>
                case &quot;Clientes&quot;:
<span class="nc" id="L275">                    mostrarVistaClientes();</span>
<span class="nc" id="L276">                    break;</span>
                case &quot;Check-in&quot;:
<span class="nc" id="L278">                    mostrarVistaCheckin();</span>
<span class="nc" id="L279">                    break;</span>
                case &quot;Reportes&quot;:
<span class="nc" id="L281">                    mostrarVistaReportes();</span>
<span class="nc" id="L282">                    break;</span>
                default:
<span class="nc" id="L284">                    logger.warning(&quot;Sección no reconocida: &quot; + seccion);</span>
            }
<span class="nc" id="L286">        });</span>
<span class="nc" id="L287">    }</span>
    
    /**
     * Muestra la vista de gestión de habitaciones.
     */
    private void mostrarVistaHabitaciones() {
<span class="nc" id="L293">        vista.cambiarContenidoPrincipal(panelHabitaciones);</span>
<span class="nc" id="L294">        cargarDatosHabitaciones();</span>
<span class="nc" id="L295">        vista.actualizarTitulo(&quot;Habitaciones&quot;);</span>
<span class="nc" id="L296">    }</span>
    
    /**
     * Muestra la vista de gestión de reservas.
     */
    private void mostrarVistaReservas() {
<span class="nc" id="L302">        vista.cambiarContenidoPrincipal(panelReservas);</span>
<span class="nc" id="L303">        cargarDatosReservas();</span>
<span class="nc" id="L304">        vista.actualizarTitulo(&quot;Reservas&quot;);</span>
<span class="nc" id="L305">    }</span>
    
    /**
     * Muestra la vista de gestión de clientes.
     */
    private void mostrarVistaClientes() {
<span class="nc" id="L311">        vista.cambiarContenidoPrincipal(panelClientes);</span>
<span class="nc" id="L312">        actualizarTablaClientes();</span>
<span class="nc" id="L313">        vista.actualizarTitulo(&quot;Clientes&quot;);</span>
<span class="nc" id="L314">    }</span>
    
    /**
     * Muestra la vista de check-in.
     */
    private void mostrarVistaCheckin() {
        // Reutilizamos panel de habitaciones filtrando solo disponibles
<span class="nc" id="L321">        vista.cambiarContenidoPrincipal(panelHabitaciones);</span>
<span class="nc" id="L322">        cargarDatosHabitaciones();</span>
<span class="nc" id="L323">        vista.actualizarTitulo(&quot;Check-in Rápido&quot;);</span>
<span class="nc" id="L324">    }</span>
    
    /**
     * Muestra la vista de reportes.
     */
    private void mostrarVistaReportes() {
<span class="nc bnc" id="L330" title="All 2 branches missed.">        if (panelReportes == null) inicializarPanelReportes();</span>
<span class="nc" id="L331">        vista.cambiarContenidoPrincipal(panelReportes);</span>
<span class="nc" id="L332">        cargarDatosReportes();</span>
<span class="nc" id="L333">        vista.actualizarTitulo(&quot;Reportes&quot;);</span>
<span class="nc" id="L334">    }</span>

    /**
     * Ejecuta un comando con soporte para Undo/Redo.
     * 
     * @param comando Comando a ejecutar
     */
    public void ejecutarComando(ICommand comando) {
        try {
<span class="nc" id="L343">            commandInvoker.executeCommand(comando);</span>
<span class="nc" id="L344">            actualizarDashboard(); // Actualizar después de cada comando</span>
<span class="nc" id="L345">        } catch (Exception e) {</span>
<span class="nc" id="L346">            logger.severe(&quot;Error ejecutando comando: &quot; + e.getMessage());</span>
<span class="nc" id="L347">            mostrarError(&quot;Error ejecutando operación: &quot; + e.getMessage());</span>
<span class="nc" id="L348">        }</span>
<span class="nc" id="L349">    }</span>

    /**
     * Ejecuta undo del último comando.
     */
    public void ejecutarUndo() {
        try {
<span class="nc bnc" id="L356" title="All 2 branches missed.">            if (commandInvoker.canUndo()) {</span>
                // Mostrar diálogo de confirmación
<span class="nc" id="L358">                int respuesta = JOptionPane.showConfirmDialog(vista,</span>
                    &quot;¿Está seguro de que desea deshacer la última operación?&quot;,
                    &quot;Confirmar Deshacer&quot;,
                    JOptionPane.YES_NO_OPTION,
                    JOptionPane.QUESTION_MESSAGE);
                    
<span class="nc bnc" id="L364" title="All 2 branches missed.">                if (respuesta == JOptionPane.YES_OPTION) {</span>
<span class="nc" id="L365">                    commandInvoker.undo();</span>
<span class="nc" id="L366">                    actualizarDashboard();</span>
<span class="nc" id="L367">                    mostrarMensaje(&quot;Operación deshecha exitosamente&quot;);</span>
                }
<span class="nc" id="L369">            } else {</span>
<span class="nc" id="L370">                mostrarMensaje(&quot;No hay operaciones para deshacer&quot;);</span>
            }
<span class="nc" id="L372">        } catch (Exception e) {</span>
<span class="nc" id="L373">            logger.severe(&quot;Error en undo: &quot; + e.getMessage());</span>
<span class="nc" id="L374">            mostrarError(&quot;Error deshaciendo operación: &quot; + e.getMessage());</span>
<span class="nc" id="L375">        }</span>
<span class="nc" id="L376">    }</span>

    /**
     * Ejecuta redo del último comando deshecho.
     */
    public void ejecutarRedo() {
        try {
<span class="nc bnc" id="L383" title="All 2 branches missed.">            if (commandInvoker.canRedo()) {</span>
                // Mostrar diálogo de confirmación
<span class="nc" id="L385">                int respuesta = JOptionPane.showConfirmDialog(vista,</span>
                    &quot;¿Está seguro de que desea rehacer la operación?&quot;,
                    &quot;Confirmar Rehacer&quot;,
                    JOptionPane.YES_NO_OPTION,
                    JOptionPane.QUESTION_MESSAGE);
                    
<span class="nc bnc" id="L391" title="All 2 branches missed.">                if (respuesta == JOptionPane.YES_OPTION) {</span>
<span class="nc" id="L392">                    commandInvoker.redo();</span>
<span class="nc" id="L393">                    actualizarDashboard();</span>
<span class="nc" id="L394">                    mostrarMensaje(&quot;Operación rehecha exitosamente&quot;);</span>
                }
<span class="nc" id="L396">            } else {</span>
<span class="nc" id="L397">                mostrarMensaje(&quot;No hay operaciones para rehacer&quot;);</span>
            }
<span class="nc" id="L399">        } catch (Exception e) {</span>
<span class="nc" id="L400">            logger.severe(&quot;Error en redo: &quot; + e.getMessage());</span>
<span class="nc" id="L401">            mostrarError(&quot;Error rehaciendo operación: &quot; + e.getMessage());</span>
<span class="nc" id="L402">        }</span>
<span class="nc" id="L403">    }</span>

    /**
     * Verifica si se puede ejecutar undo.
     */
    public boolean puedeDeshacer() {
<span class="nc" id="L409">        return commandInvoker.canUndo();</span>
    }

    /**
     * Verifica si se puede ejecutar redo.
     */
    public boolean puedeRehacer() {
<span class="nc" id="L416">        return commandInvoker.canRedo();</span>
    }

    /**
     * Muestra un mensaje de error al usuario.
     */
    public void mostrarError(String mensaje) {
<span class="nc" id="L423">        JOptionPane.showMessageDialog(vista, mensaje, &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);</span>
<span class="nc" id="L424">    }</span>

    /**
     * Muestra un mensaje informativo al usuario.
     */
    public void mostrarMensaje(String mensaje) {
<span class="nc" id="L430">        JOptionPane.showMessageDialog(vista, mensaje, &quot;Información&quot;, JOptionPane.INFORMATION_MESSAGE);</span>
<span class="nc" id="L431">    }</span>

    /**
     * Obtiene el servicio del modelo para uso externo.
     */
    public IModeloService getModeloService() {
<span class="nc" id="L437">        return modeloService;</span>
    }

    /**
     * Obtiene el gestor de disponibilidad.
     */
    public GestorDisponibilidad getGestorDisponibilidad() {
<span class="nc" id="L444">        return gestorDisponibilidad;</span>
    }

    /**
     * Obtiene el command invoker.
     */
    public ICommandInvoker getCommandInvoker() {
<span class="nc" id="L451">        return commandInvoker;</span>
    }

    /**
     * Gestiona la navegación del menú principal.
     * Este es el núcleo del patrón MVC para la navegación.
     * La vista (VentanaAdmin) notifica al controlador, y el controlador
     * decide qué mostrar.
     * 
     * @param itemMenu El item del menú seleccionado.
     */
    public void navegarHacia(String itemMenu) {
<span class="nc" id="L463">        logger.info(&quot;Navegando hacia: &quot; + itemMenu);</span>
<span class="nc bnc" id="L464" title="All 5 branches missed.">        switch (itemMenu) {</span>
            case &quot;Dashboard&quot;:
<span class="nc" id="L466">                vista.cambiarContenidoPrincipal(panelDashboard);</span>
<span class="nc" id="L467">                actualizarDashboard(); // Asegurarse de que los datos están frescos</span>
<span class="nc" id="L468">                break;</span>
            case &quot;Clientes&quot;:
<span class="nc" id="L470">                vista.cambiarContenidoPrincipal(panelClientes);</span>
<span class="nc" id="L471">                actualizarTablaClientes();</span>
<span class="nc" id="L472">                break;</span>
            case &quot;Habitaciones&quot;:
<span class="nc" id="L474">                vista.cambiarContenidoPrincipal(panelHabitaciones);</span>
<span class="nc" id="L475">                cargarDatosHabitaciones();</span>
<span class="nc" id="L476">                break;</span>
            case &quot;Reservas&quot;:
<span class="nc" id="L478">                vista.cambiarContenidoPrincipal(panelReservas);</span>
<span class="nc" id="L479">                cargarDatosReservas();</span>
<span class="nc" id="L480">                break;</span>
            // Añadir casos para &quot;Habitaciones&quot;, &quot;Reservas&quot;, etc.
            default:
                // Opcional: mostrar un panel por defecto o un mensaje
<span class="nc" id="L484">                vista.cambiarContenidoPrincipal(panelDashboard);</span>
                break;
        }
<span class="nc" id="L487">    }</span>

    /**
     * Actualiza la tabla de clientes en el panel de clientes.
     */
    private void actualizarTablaClientes() {
        try {
<span class="nc" id="L494">            List&lt;Cliente&gt; clientes = modeloService.obtenerTodosClientes();</span>
<span class="nc" id="L495">            DefaultTableModel model = (DefaultTableModel) panelClientes.getTablaClientes().getModel();</span>
<span class="nc" id="L496">            model.setRowCount(0); // Limpiar tabla</span>
<span class="nc bnc" id="L497" title="All 2 branches missed.">            for (Cliente cliente : clientes) {</span>
<span class="nc" id="L498">                model.addRow(new Object[]{</span>
<span class="nc" id="L499">                    cliente.getId(),</span>
<span class="nc" id="L500">                    cliente.getNombre(),</span>
<span class="nc" id="L501">                    cliente.getApellido(),</span>
<span class="nc" id="L502">                    cliente.getCedula(),</span>
<span class="nc" id="L503">                    cliente.getTelefono()</span>
                });
<span class="nc" id="L505">            }</span>
<span class="nc" id="L506">        } catch (Exception e) {</span>
<span class="nc" id="L507">            logger.severe(&quot;Error al actualizar la tabla de clientes: &quot; + e.getMessage());</span>
<span class="nc" id="L508">            mostrarError(&quot;No se pudo cargar la lista de clientes.&quot;);</span>
<span class="nc" id="L509">        }</span>
<span class="nc" id="L510">    }</span>

    // ====== HABITACIONES ======
    private void inicializarEventosHabitaciones() {
<span class="nc" id="L514">        panelHabitaciones.getBtnRefrescar().addActionListener(e -&gt; cargarDatosHabitaciones());</span>
<span class="nc" id="L515">        panelHabitaciones.getBtnVolver().addActionListener(e -&gt; navegarHacia(&quot;Dashboard&quot;));</span>
<span class="nc" id="L516">        panelHabitaciones.getBtnCheckinRapido().addActionListener(e -&gt; checkinRapidoDesdeHabitaciones());</span>
<span class="nc" id="L517">        panelHabitaciones.getBtnLiberar().addActionListener(e -&gt; liberarHabitacionSeleccionada());</span>
<span class="nc" id="L518">    }</span>

    private void cargarDatosHabitaciones() {
        try {
<span class="nc" id="L522">            controladorHabitaciones.cargarHabitaciones(</span>
<span class="nc" id="L523">                panelHabitaciones.getTablaDisponibles(),</span>
<span class="nc" id="L524">                panelHabitaciones.getTablaOcupadas(),</span>
<span class="nc" id="L525">                panelHabitaciones.getComboSeleccionHabitacion()</span>
            );
<span class="nc" id="L527">        } catch (Exception ex) {</span>
<span class="nc" id="L528">            logger.severe(&quot;Error cargando habitaciones: &quot; + ex.getMessage());</span>
<span class="nc" id="L529">            mostrarError(&quot;No se pudieron cargar las habitaciones.&quot;);</span>
<span class="nc" id="L530">        }</span>
<span class="nc" id="L531">    }</span>

    private void checkinRapidoDesdeHabitaciones() {
<span class="nc" id="L534">        String seleccion = (String) panelHabitaciones.getComboSeleccionHabitacion().getSelectedItem();</span>
<span class="nc bnc" id="L535" title="All 2 branches missed.">        if (seleccion == null) {</span>
<span class="nc" id="L536">            mostrarMensaje(&quot;No hay habitaciones disponibles para check-in.&quot;);</span>
<span class="nc" id="L537">            return;</span>
        }
        // Solicitar datos mínimos del cliente
<span class="nc" id="L540">        JTextField nombre = new JTextField();</span>
<span class="nc" id="L541">        JTextField apellido = new JTextField();</span>
<span class="nc" id="L542">        JTextField cedula = new JTextField();</span>
<span class="nc" id="L543">        JTextField telefono = new JTextField();</span>
<span class="nc" id="L544">        Object[] msg = {&quot;Nombre:&quot;, nombre, &quot;Apellido:&quot;, apellido, &quot;Cédula:&quot;, cedula, &quot;Teléfono:&quot;, telefono};</span>
<span class="nc" id="L545">        int op = JOptionPane.showConfirmDialog(vista, msg, &quot;Check-in Rápido&quot;, JOptionPane.OK_CANCEL_OPTION);</span>
<span class="nc bnc" id="L546" title="All 2 branches missed.">        if (op == JOptionPane.OK_OPTION) {</span>
            try {
                // Formato esperado: &quot;#001 | Tipo | $Precio&quot;
<span class="nc" id="L549">                String numeroHab = seleccion.split(&quot; \\|&quot;)[0].replace(&quot;#&quot;, &quot;&quot;).trim();</span>
<span class="nc" id="L550">                Habitacion hab = modeloService.buscarHabitacionPorNumero(numeroHab);</span>
<span class="nc bnc" id="L551" title="All 2 branches missed.">                if (hab == null) {mostrarError(&quot;Habitación no encontrada.&quot;); return;}</span>
<span class="nc" id="L552">                Cliente existente = modeloService.buscarClientePorCedula(cedula.getText());</span>
<span class="nc bnc" id="L553" title="All 2 branches missed.">                Cliente cli = existente != null ? existente : new Cliente(java.util.UUID.randomUUID().toString(), nombre.getText(), apellido.getText(), cedula.getText(), telefono.getText());</span>
<span class="nc" id="L554">                ejecutarComando(new CheckinRapidoAdminCommand(modeloService, cli, hab));</span>
<span class="nc" id="L555">                mostrarMensaje(&quot;Check-in registrado.&quot;);</span>
<span class="nc" id="L556">                cargarDatosHabitaciones();</span>
<span class="nc" id="L557">            } catch (Exception ex) {</span>
<span class="nc" id="L558">                mostrarError(&quot;Error en check-in: &quot; + ex.getMessage());</span>
<span class="nc" id="L559">            }</span>
        }
<span class="nc" id="L561">    }</span>

    private void liberarHabitacionSeleccionada() {
<span class="nc" id="L564">        int fila = panelHabitaciones.getTablaOcupadas().getSelectedRow();</span>
<span class="nc bnc" id="L565" title="All 2 branches missed.">        if (fila == -1) {mostrarMensaje(&quot;Seleccione una habitación ocupada.&quot;); return;}</span>
<span class="nc" id="L566">        String numero = panelHabitaciones.getTablaOcupadas().getValueAt(fila,0).toString().replace(&quot;#&quot;,&quot; &quot;).trim();</span>
<span class="nc" id="L567">        Habitacion hab = modeloService.buscarHabitacionPorNumero(numero.trim());</span>
<span class="nc bnc" id="L568" title="All 2 branches missed.">        if (hab == null) {mostrarError(&quot;No se encontró la habitación.&quot;); return;}</span>
        // Buscar reserva activa asociada
<span class="nc" id="L570">        List&lt;Reserva&gt; reservas = modeloService.obtenerTodasReservas();</span>
<span class="nc bnc" id="L571" title="All 4 branches missed.">        Reserva activa = reservas.stream().filter(r -&gt; r.getIdHabitacion().equals(hab.getId()) &amp;&amp; r.getFechaSalida()==null).findFirst().orElse(null);</span>
<span class="nc bnc" id="L572" title="All 2 branches missed.">        if (activa == null) {mostrarMensaje(&quot;No hay reserva activa.&quot;); return;}</span>
<span class="nc" id="L573">    ejecutarComando(new FinalizarReservaCommand(modeloService, activa.getId()));</span>
<span class="nc" id="L574">    mostrarMensaje(&quot;Habitación liberada.&quot;);</span>
<span class="nc" id="L575">    cargarDatosHabitaciones();</span>
<span class="nc" id="L576">    }</span>

    // ====== RESERVAS ======
    private void inicializarEventosReservas() {
<span class="nc" id="L580">        panelReservas.getBtnRefrescar().addActionListener(e -&gt; cargarDatosReservas());</span>
<span class="nc" id="L581">        panelReservas.getBtnVolver().addActionListener(e -&gt; navegarHacia(&quot;Dashboard&quot;));</span>
<span class="nc" id="L582">        panelReservas.getBtnNuevaReserva().addActionListener(e -&gt; crearNuevaReserva());</span>
<span class="nc" id="L583">        panelReservas.getBtnFinalizarReserva().addActionListener(e -&gt; finalizarReservaSeleccionada());</span>
<span class="nc" id="L584">    }</span>

    private void cargarDatosReservas() {
        try {
<span class="nc" id="L588">            List&lt;Reserva&gt; reservas = modeloService.obtenerTodasReservas();</span>
<span class="nc" id="L589">            List&lt;Cliente&gt; clientes = modeloService.obtenerTodosClientes();</span>
<span class="nc" id="L590">            List&lt;Habitacion&gt; habitaciones = modeloService.obtenerTodasHabitaciones();</span>
<span class="nc" id="L591">            java.util.Map&lt;String,Cliente&gt; mapCli = clientes.stream().collect(java.util.stream.Collectors.toMap(Cliente::getId,c-&gt;c));</span>
<span class="nc" id="L592">            java.util.Map&lt;String,Habitacion&gt; mapHab = habitaciones.stream().collect(java.util.stream.Collectors.toMap(Habitacion::getId,h-&gt;h));</span>
<span class="nc" id="L593">            javax.swing.table.DefaultTableModel model = (javax.swing.table.DefaultTableModel) panelReservas.getTablaReservas().getModel();</span>
<span class="nc" id="L594">            model.setRowCount(0);</span>
<span class="nc" id="L595">            java.text.SimpleDateFormat sdf = new java.text.SimpleDateFormat(&quot;dd/MM/yyyy&quot;);</span>
<span class="nc bnc" id="L596" title="All 2 branches missed.">            for (Reserva r: reservas) {</span>
<span class="nc" id="L597">                Cliente c = mapCli.get(r.getIdCliente());</span>
<span class="nc" id="L598">                Habitacion h = mapHab.get(r.getIdHabitacion());</span>
<span class="nc bnc" id="L599" title="All 6 branches missed.">                String estado = r.getFechaSalida()!=null?&quot;Finalizada&quot;:(h!=null &amp;&amp; h.isOcupada()?&quot;Check-in&quot;:&quot;Reservada&quot;);</span>
<span class="nc bnc" id="L600" title="All 6 branches missed.">                model.addRow(new Object[]{r.getId(), c!=null?c.getNombre()+&quot; &quot;+c.getApellido():&quot;?&quot;, h!=null?h.getNumero():&quot;?&quot;, sdf.format(r.getFechaIngreso()), r.getFechaSalida()!=null?sdf.format(r.getFechaSalida()):&quot;--&quot;, estado, String.format(&quot;$%.2f&quot;, r.getTotal())});</span>
<span class="nc" id="L601">            }</span>
<span class="nc" id="L602">        } catch (Exception ex) {</span>
<span class="nc" id="L603">            mostrarError(&quot;Error cargando reservas.&quot;);</span>
<span class="nc" id="L604">        }</span>
<span class="nc" id="L605">    }</span>

    private void crearNuevaReserva() {
        try {
<span class="nc" id="L609">            java.util.List&lt;Cliente&gt; clientes = modeloService.obtenerTodosClientes();</span>
<span class="nc bnc" id="L610" title="All 2 branches missed.">            if (clientes.isEmpty()) {mostrarMensaje(&quot;No hay clientes. Cree uno primero.&quot;); return;}</span>
<span class="nc" id="L611">            java.util.List&lt;Habitacion&gt; disponibles = modeloService.obtenerHabitacionesDisponibles();</span>
<span class="nc bnc" id="L612" title="All 2 branches missed.">            if (disponibles.isEmpty()) {mostrarMensaje(&quot;No hay habitaciones disponibles.&quot;); return;}</span>

<span class="nc" id="L614">            JComboBox&lt;Cliente&gt; comboCliente = new JComboBox&lt;&gt;(clientes.toArray(new Cliente[0]));</span>
<span class="nc" id="L615">            JComboBox&lt;Habitacion&gt; comboHab = new JComboBox&lt;&gt;(disponibles.toArray(new Habitacion[0]));</span>
<span class="nc" id="L616">            JSpinner spinnerNoches = new JSpinner(new SpinnerNumberModel(1,1,30,1));</span>
<span class="nc" id="L617">            JTextArea observaciones = new JTextArea(3,25);</span>
<span class="nc" id="L618">            observaciones.setLineWrap(true);</span>
<span class="nc" id="L619">            observaciones.setWrapStyleWord(true);</span>
<span class="nc" id="L620">            JPanel panel = new JPanel(new GridBagLayout());</span>
<span class="nc" id="L621">            GridBagConstraints gbc = new GridBagConstraints();</span>
<span class="nc" id="L622">            gbc.insets = new java.awt.Insets(4,4,4,4);</span>
<span class="nc" id="L623">            gbc.anchor = GridBagConstraints.WEST;</span>
<span class="nc" id="L624">            gbc.gridx=0; gbc.gridy=0; panel.add(new JLabel(&quot;Cliente:&quot;), gbc);</span>
<span class="nc" id="L625">            gbc.gridx=1; panel.add(comboCliente, gbc);</span>
<span class="nc" id="L626">            gbc.gridx=0; gbc.gridy=1; panel.add(new JLabel(&quot;Habitación:&quot;), gbc);</span>
<span class="nc" id="L627">            gbc.gridx=1; panel.add(comboHab, gbc);</span>
<span class="nc" id="L628">            gbc.gridx=0; gbc.gridy=2; panel.add(new JLabel(&quot;Noches:&quot;), gbc);</span>
<span class="nc" id="L629">            gbc.gridx=1; panel.add(spinnerNoches, gbc);</span>
<span class="nc" id="L630">            gbc.gridx=0; gbc.gridy=3; gbc.anchor=GridBagConstraints.NORTHWEST; panel.add(new JLabel(&quot;Observaciones:&quot;), gbc);</span>
<span class="nc" id="L631">            gbc.gridx=1; panel.add(new JScrollPane(observaciones), gbc);</span>

<span class="nc" id="L633">            int opt = JOptionPane.showConfirmDialog(vista, panel, &quot;Nueva Reserva&quot;, JOptionPane.OK_CANCEL_OPTION, JOptionPane.PLAIN_MESSAGE);</span>
<span class="nc bnc" id="L634" title="All 2 branches missed.">            if (opt != JOptionPane.OK_OPTION) return;</span>

<span class="nc" id="L636">            Cliente seleccionado = (Cliente) comboCliente.getSelectedItem();</span>
<span class="nc" id="L637">            Habitacion hab = (Habitacion) comboHab.getSelectedItem();</span>
<span class="nc" id="L638">            int noches = (Integer) spinnerNoches.getValue();</span>
<span class="nc" id="L639">            double total = hab.getPrecio() * noches;</span>
<span class="nc bnc" id="L640" title="All 2 branches missed.">            String obs = observaciones.getText()!=null?observaciones.getText().trim():&quot;&quot;;</span>
<span class="nc" id="L641">            ejecutarComando(new CrearReservaCommand(modeloService, seleccionado.getId(), hab.getId(), total, obs));</span>
<span class="nc" id="L642">            mostrarMensaje(&quot;Reserva creada correctamente. Total: $&quot;+String.format(&quot;%.2f&quot;, total));</span>
<span class="nc" id="L643">            cargarDatosReservas();</span>
<span class="nc" id="L644">        } catch (NumberFormatException nfe) {</span>
<span class="nc" id="L645">            mostrarError(&quot;Número de noches inválido.&quot;);</span>
<span class="nc" id="L646">        } catch (Exception ex) {</span>
<span class="nc" id="L647">            mostrarError(&quot;Error creando reserva: &quot;+ex.getMessage());</span>
<span class="nc" id="L648">        }</span>
<span class="nc" id="L649">    }</span>

    private void finalizarReservaSeleccionada() {
<span class="nc" id="L652">        int fila = panelReservas.getTablaReservas().getSelectedRow();</span>
<span class="nc bnc" id="L653" title="All 2 branches missed.">        if (fila==-1) {mostrarMensaje(&quot;Seleccione una reserva.&quot;); return;}</span>
<span class="nc" id="L654">        String id = panelReservas.getTablaReservas().getValueAt(fila,0).toString();</span>
<span class="nc" id="L655">        ejecutarComando(new FinalizarReservaCommand(modeloService, id));</span>
<span class="nc" id="L656">        mostrarMensaje(&quot;Reserva finalizada.&quot;);</span>
<span class="nc" id="L657">        cargarDatosReservas();</span>
<span class="nc" id="L658">    }</span>

    /**
     * Inicializa los eventos para el panel de gestión de clientes.
     * Siguiendo MVC, el controlador asigna los listeners a los componentes de la vista.
     */
    private void inicializarEventosClientes() {
<span class="nc" id="L665">        panelClientes.getBtnNuevoCliente().addActionListener(e -&gt; agregarNuevoCliente());</span>
<span class="nc" id="L666">        panelClientes.getBtnEditarCliente().addActionListener(e -&gt; editarClienteSeleccionado());</span>
<span class="nc" id="L667">        panelClientes.getBtnEliminarCliente().addActionListener(e -&gt; eliminarClienteSeleccionado());</span>
<span class="nc" id="L668">    panelClientes.getBtnBuscarCedula().addActionListener(e -&gt; buscarClientePorCedula());</span>
<span class="nc" id="L669">    panelClientes.getBtnLimpiarBusqueda().addActionListener(e -&gt; {panelClientes.getTxtBuscarCedula().setText(&quot;&quot;); actualizarTablaClientes();});</span>
<span class="nc" id="L670">    }</span>

    /**
     * Muestra un formulario para agregar un nuevo cliente.
     */
    private void agregarNuevoCliente() {
        // Usamos JOptionPane para una entrada de datos simple
<span class="nc" id="L677">        JTextField nombreField = new JTextField();</span>
<span class="nc" id="L678">        JTextField apellidoField = new JTextField();</span>
<span class="nc" id="L679">        JTextField cedulaField = new JTextField();</span>
<span class="nc" id="L680">        JTextField telefonoField = new JTextField();</span>

<span class="nc" id="L682">        Object[] message = {</span>
            &quot;Nombre:&quot;, nombreField,
            &quot;Apellido:&quot;, apellidoField,
            &quot;Cédula:&quot;, cedulaField,
            &quot;Teléfono:&quot;, telefonoField
        };

<span class="nc" id="L689">    int option = JOptionPane.showConfirmDialog(vista, message, &quot;Agregar Nuevo Cliente&quot;, JOptionPane.OK_CANCEL_OPTION);</span>
<span class="nc bnc" id="L690" title="All 2 branches missed.">        if (option == JOptionPane.OK_OPTION) {</span>
            try {
<span class="nc" id="L692">        String nombre = nombreField.getText().trim();</span>
<span class="nc" id="L693">        String apellido = apellidoField.getText().trim();</span>
<span class="nc" id="L694">        String cedula = cedulaField.getText().trim();</span>
<span class="nc" id="L695">        String telefono = telefonoField.getText().trim();</span>

<span class="nc" id="L697">        String validacion = validarDatosCliente(nombre, apellido, cedula, telefono, true);</span>
<span class="nc bnc" id="L698" title="All 2 branches missed.">        if (validacion != null) {mostrarError(validacion); return;}</span>

<span class="nc" id="L700">        Cliente nuevoCliente = new Cliente(null, nombre, apellido, cedula, telefono);</span>
<span class="nc" id="L701">        boolean ok = modeloService.registrarCliente(nuevoCliente);</span>
<span class="nc bnc" id="L702" title="All 2 branches missed.">        if (ok) {actualizarTablaClientes(); mostrarMensaje(&quot;Cliente agregado exitosamente.&quot;);}</span>
<span class="nc" id="L703">        else {mostrarError(&quot;No se pudo registrar. Cédula o teléfono ya existentes.&quot;);}</span>

<span class="nc" id="L705">            } catch (Exception ex) {</span>
<span class="nc" id="L706">                logger.severe(&quot;Error al agregar cliente: &quot; + ex.getMessage());</span>
<span class="nc" id="L707">                mostrarError(&quot;No se pudo agregar el cliente. Verifique los datos.&quot;);</span>
<span class="nc" id="L708">            }</span>
        }
<span class="nc" id="L710">    }</span>

    private String validarDatosCliente(String nombre, String apellido, String cedula, String telefono, boolean nuevo){
<span class="nc bnc" id="L713" title="All 8 branches missed.">        if (nombre.isEmpty() || apellido.isEmpty() || cedula.isEmpty() || telefono.isEmpty()) return &quot;Todos los campos son obligatorios&quot;;</span>
<span class="nc bnc" id="L714" title="All 2 branches missed.">        if (!cedula.matches(&quot;\\d{6,13}&quot;)) return &quot;La cédula debe tener entre 6 y 13 dígitos&quot;;</span>
<span class="nc bnc" id="L715" title="All 2 branches missed.">        if (!telefono.matches(&quot;\\d{7,15}&quot;)) return &quot;El teléfono debe ser numérico (7-15 dígitos)&quot;;</span>
<span class="nc bnc" id="L716" title="All 4 branches missed.">        if (nuevo &amp;&amp; modeloService.existeCedula(cedula)) return &quot;La cédula ya está registrada&quot;;</span>
<span class="nc bnc" id="L717" title="All 4 branches missed.">        if (nuevo &amp;&amp; modeloService.existeTelefono(telefono)) return &quot;El teléfono ya está registrado&quot;;</span>
<span class="nc" id="L718">        return null;</span>
    }

    private void buscarClientePorCedula(){
<span class="nc" id="L722">        String cedula = panelClientes.getTxtBuscarCedula().getText().trim();</span>
<span class="nc bnc" id="L723" title="All 2 branches missed.">        if (cedula.isEmpty()) {mostrarMensaje(&quot;Ingrese una cédula para buscar&quot;); return;}</span>
<span class="nc" id="L724">        Cliente c = modeloService.buscarClientePorCedula(cedula);</span>
<span class="nc" id="L725">        DefaultTableModel model = (DefaultTableModel) panelClientes.getTablaClientes().getModel();</span>
<span class="nc" id="L726">        model.setRowCount(0);</span>
<span class="nc bnc" id="L727" title="All 2 branches missed.">        if (c != null) {</span>
<span class="nc" id="L728">            model.addRow(new Object[]{c.getId(), c.getNombre(), c.getApellido(), c.getCedula(), c.getTelefono()});</span>
        } else {
<span class="nc" id="L730">            mostrarMensaje(&quot;No se encontró cliente con esa cédula&quot;);</span>
        }
<span class="nc" id="L732">    }</span>

    /**
     * Muestra un formulario para editar el cliente seleccionado en la tabla.
     */
    private void editarClienteSeleccionado() {
<span class="nc" id="L738">        int filaSeleccionada = panelClientes.getTablaClientes().getSelectedRow();</span>
<span class="nc bnc" id="L739" title="All 2 branches missed.">        if (filaSeleccionada == -1) {</span>
<span class="nc" id="L740">            JOptionPane.showMessageDialog(vista, &quot;Por favor, seleccione un cliente para editar.&quot;, &quot;Advertencia&quot;, JOptionPane.WARNING_MESSAGE);</span>
<span class="nc" id="L741">            return;</span>
        }

        // Obtener datos de la tabla
<span class="nc" id="L745">        String id = (String) panelClientes.getTablaClientes().getValueAt(filaSeleccionada, 0);</span>
<span class="nc" id="L746">        String nombre = (String) panelClientes.getTablaClientes().getValueAt(filaSeleccionada, 1);</span>
<span class="nc" id="L747">        String apellido = (String) panelClientes.getTablaClientes().getValueAt(filaSeleccionada, 2);</span>
<span class="nc" id="L748">        String cedula = (String) panelClientes.getTablaClientes().getValueAt(filaSeleccionada, 3);</span>
<span class="nc" id="L749">        String telefono = (String) panelClientes.getTablaClientes().getValueAt(filaSeleccionada, 4);</span>

        // Pre-llenar el formulario de edición
<span class="nc" id="L752">        JTextField nombreField = new JTextField(nombre);</span>
<span class="nc" id="L753">        JTextField apellidoField = new JTextField(apellido);</span>
<span class="nc" id="L754">        JTextField cedulaField = new JTextField(cedula);</span>
<span class="nc" id="L755">        JTextField telefonoField = new JTextField(telefono);</span>

<span class="nc" id="L757">        Object[] message = {</span>
            &quot;Nombre:&quot;, nombreField,
            &quot;Apellido:&quot;, apellidoField,
            &quot;Cédula:&quot;, cedulaField,
            &quot;Teléfono:&quot;, telefonoField
        };

<span class="nc" id="L764">        int option = JOptionPane.showConfirmDialog(vista, message, &quot;Editar Cliente&quot;, JOptionPane.OK_CANCEL_OPTION);</span>
<span class="nc bnc" id="L765" title="All 2 branches missed.">        if (option == JOptionPane.OK_OPTION) {</span>
            try {
<span class="nc" id="L767">                Cliente clienteActualizado = new Cliente(</span>
                    id,
<span class="nc" id="L769">                    nombreField.getText(),</span>
<span class="nc" id="L770">                    apellidoField.getText(),</span>
<span class="nc" id="L771">                    cedulaField.getText(),</span>
<span class="nc" id="L772">                    telefonoField.getText()</span>
                );

<span class="nc" id="L775">                boolean ok = modeloService.actualizarCliente(clienteActualizado);</span>
<span class="nc bnc" id="L776" title="All 2 branches missed.">                if (ok) {</span>
<span class="nc" id="L777">                    actualizarTablaClientes();</span>
<span class="nc" id="L778">                    JOptionPane.showMessageDialog(vista, &quot;Cliente actualizado exitosamente.&quot;);</span>
                } else {
<span class="nc" id="L780">                    mostrarError(&quot;No se pudo actualizar el cliente.&quot;);</span>
                }

<span class="nc" id="L783">            } catch (Exception ex) {</span>
<span class="nc" id="L784">                logger.severe(&quot;Error al actualizar cliente: &quot; + ex.getMessage());</span>
<span class="nc" id="L785">                mostrarError(&quot;No se pudo actualizar el cliente.&quot;);</span>
<span class="nc" id="L786">            }</span>
        }
<span class="nc" id="L788">    }</span>

    /**
     * Elimina el cliente seleccionado en la tabla.
     */
    private void eliminarClienteSeleccionado() {
<span class="nc" id="L794">        int filaSeleccionada = panelClientes.getTablaClientes().getSelectedRow();</span>
<span class="nc bnc" id="L795" title="All 2 branches missed.">        if (filaSeleccionada == -1) {</span>
<span class="nc" id="L796">            JOptionPane.showMessageDialog(vista, &quot;Por favor, seleccione un cliente para eliminar.&quot;, &quot;Advertencia&quot;, JOptionPane.WARNING_MESSAGE);</span>
<span class="nc" id="L797">            return;</span>
        }

<span class="nc" id="L800">        int confirmacion = JOptionPane.showConfirmDialog(vista, &quot;¿Está seguro de que desea eliminar a este cliente?&quot;, &quot;Confirmar Eliminación&quot;, JOptionPane.YES_NO_OPTION);</span>
<span class="nc bnc" id="L801" title="All 2 branches missed.">        if (confirmacion == JOptionPane.YES_OPTION) {</span>
            try {
<span class="nc" id="L803">                String id = (String) panelClientes.getTablaClientes().getValueAt(filaSeleccionada, 0);</span>
<span class="nc" id="L804">                boolean ok = modeloService.eliminarCliente(id);</span>
<span class="nc bnc" id="L805" title="All 2 branches missed.">                if (ok) {</span>
<span class="nc" id="L806">                    actualizarTablaClientes();</span>
<span class="nc" id="L807">                    JOptionPane.showMessageDialog(vista, &quot;Cliente eliminado exitosamente.&quot;);</span>
                } else {
<span class="nc" id="L809">                    mostrarError(&quot;No se pudo eliminar el cliente.&quot;);</span>
                }

<span class="nc" id="L812">            } catch (Exception ex) {</span>
<span class="nc" id="L813">                logger.severe(&quot;Error al eliminar cliente: &quot; + ex.getMessage());</span>
<span class="nc" id="L814">                mostrarError(&quot;No se pudo eliminar el cliente.&quot;);</span>
<span class="nc" id="L815">            }</span>
        }
<span class="nc" id="L817">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>